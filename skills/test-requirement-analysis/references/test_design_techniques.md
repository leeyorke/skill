# 测试设计技术深度解析

## RESTful API测试模式

### 认证测试矩阵

**测试维度:**
```
1. 凭证类型:有效 | 无效 | 过期 | 格式错误
2. Token状态:新鲜 | 过期 | 已撤销 | 被篡改
3. 权限级别:管理员 | 用户 | 访客 | 无
4. 头格式:正确 | 缺失 | 错误scheme | 格式错误
```

**全面测试用例:**
```
TC01:有效token + 足够权限 → 200 OK
TC02:有效token + 权限不足 → 403 Forbidden
TC03:过期token → 401 Unauthorized
TC04:无效token → 401 Unauthorized
TC05:缺少Authorization头 → 401 Unauthorized
TC06:头格式错误(Bearer拼写错误) → 401 Unauthorized
TC07:来自不同环境的token → 401 Unauthorized
TC08:已撤销的token → 401 Unauthorized
```

### 请求验证模式

**字符串字段验证:**
```
字段:email(必填,最大100字符)

测试用例:
1. 有效邮箱:"user@example.com" → 接受
2. 缺少@符号:"userexample.com" → 400 Bad Request
3. 缺少域名:"user@" → 400 Bad Request
4. 多个@符号:"user@@example.com" → 400 Bad Request
5. 空字符串:"" → 400 Bad Request
6. Null值:null → 400 Bad Request
7. 请求中缺少字段 → 400 Bad Request
8. 最大长度(100字符):100字符的有效邮箱 → 接受
9. 最大长度+1:101字符的有效邮箱 → 400 Bad Request
10. 特殊字符:"user+tag@example.com" → 接受
11. Unicode字符:"用户@example.com" → 按规范测试
12. SQL注入尝试:"user'; DROP TABLE--@example.com" → 净化/400
13. XSS尝试:"<script>alert('xss')</script>@example.com" → 净化/400
```

**数字字段验证:**
```
字段:age(整数,最小0,最大150)

测试用例:
1. 有效值:25 → 接受
2. 最小边界:0 → 接受
3. 低于最小值:-1 → 400 Bad Request
4. 最大边界:150 → 接受
5. 高于最大值:151 → 400 Bad Request
6. 小数值:25.5 → 400 Bad Request(如果要求整数)
7. 字符串值:"25" → 按规范测试(可能自动转换或拒绝)
8. 非数字字符串:"abc" → 400 Bad Request
9. Null值:null → 400 Bad Request
10. 缺少字段 → 400 Bad Request
11. 科学记数法:2.5e1 → 按规范测试
12. Infinity/NaN → 400 Bad Request
```

**数组字段验证:**
```
字段:tags(字符串数组,最少1项,最多10项)

测试用例:
1. 有效数组:["tag1", "tag2"] → 接受
2. 空数组:[] → 400 Bad Request(最少1项)
3. 单项:["tag1"] → 接受
4. 最大项数(10) → 接受
5. 最大项数+1(11) → 400 Bad Request
6. Null值:null → 400 Bad Request
7. 非数组:"tag1" → 400 Bad Request
8. 数组中有null项:["tag1", null] → 按规范测试
9. 数组中有空字符串:["tag1", ""] → 按规范测试
10. 数组中有重复项:["tag1", "tag1"] → 按规范测试
11. 嵌套数组:[["tag1"]] → 400 Bad Request
```

**对象字段验证:**
```
字段:address(有必填字段的对象)

测试用例:
1. 有效完整对象 → 接受
2. 缺少必填字段 → 400 Bad Request
3. 额外未知字段 → 按规范测试(严格/宽松模式)
4. Null对象:null → 400 Bad Request
5. 空对象:{} → 400 Bad Request(如有必填字段)
6. 嵌套对象验证 → 递归验证
7. 对象作为数组:[{}] → 400 Bad Request
8. 对象作为字符串:"address" → 400 Bad Request
```

### HTTP方法测试

**GET请求:**
```
测试:
- 查询参数:有效/无效/缺失
- 分页:page、limit、offset边界情况
- 过滤:单个/多个过滤器,无效过滤字段
- 排序:升序/降序,无效排序字段,多重排序
- 搜索:空查询、特殊字符、长字符串
- 响应:正确状态码、模式验证、数据准确性
- 缓存:ETag、If-None-Match、Last-Modified头
- 性能:不同结果大小的响应时间
```

**POST请求:**
```
测试:
- 请求体:有效/无效/格式错误的JSON
- Content-Type头:正确/缺失/错误
- 幂等性:多个相同请求
- 201 Created状态带Location头
- 响应体包含创建的资源
- 数据库:验证数据正确持久化
- 副作用:邮件发送、事件触发
- 重复防护:唯一约束违规
```

**PUT/PATCH请求:**
```
测试:
- 完全 vs 部分更新(PUT vs PATCH)
- 更新不存在的资源 → 404
- 乐观锁定(ETag/版本冲突)
- 带无效字段的部分更新
- Null值:删除字段 vs 忽略
- 更新不可变字段 → 400/403
- 并发更新竞态条件
```

**DELETE请求:**
```
测试:
- 成功删除 → 204 No Content或200 OK
- 删除不存在的资源 → 404
- 删除已删除的资源 → 404或410 Gone
- 软删除 vs 硬删除验证
- 级联删除:相关资源被删除
- 引用完整性:如被引用则阻止删除
- 权限检查:仅所有者可删除
```

## Web应用测试模式

### 表单验证测试

**客户端 vs 服务端:**
```
分别测试两层:

1. 禁用JavaScript → 测试服务端验证
2. 操作DOM → 绕过客户端验证
3. 直接API调用 → 确保服务器验证
4. 错误消息:两侧一致
```

**输入字段测试:**
```
对每个表单字段:
1. 有效输入 → 接受
2. 空字段(如果必填) → 显示错误
3. 无效格式 → 显示具体错误消息
4. 最大长度强制 → 截断或拒绝
5. 特殊字符:<、>、&、"、' → 净化
6. 复制粘贴带尾随空格 → 修剪
7. 自动完成行为
8. Tab键顺序导航
9. 错误消息清晰度和位置
10. 提交后错误持久性
```

### 跨浏览器测试

**优先级矩阵:**
```
P0(必须测试):
- Chrome(最新2个版本)
- Firefox(最新2个版本)
- Safari(最新2个版本)
- Edge(最新版本)

P1(应该测试):
- Mobile Safari(iOS)
- Chrome Mobile(Android)

P2(建议测试):
- 旧版浏览器
- Opera、Samsung Internet
```

**浏览器特定测试:**
```
CSS渲染:
- Flexbox布局
- Grid布局
- CSS变量
- 自定义字体
- 动画和过渡

JavaScript功能:
- ES6+语法支持
- Fetch API vs XMLHttpRequest
- LocalStorage/SessionStorage
- WebSockets
- Service Workers

HTML5功能:
- Input类型支持(date、color、range)
- 视频/音频播放
- Canvas渲染
- SVG支持
```

### 响应式设计测试

**断点测试:**
```
标准断点:
- 移动设备:320px、375px、414px
- 平板:768px、1024px
- 桌面:1366px、1920px

在每个断点测试:
1. 布局完整性(无重叠)
2. 导航菜单(移动端汉堡菜单)
3. 图片适当调整大小/裁剪
4. 文本可读性(字体大小)
5. 移动端触摸目标 ≥ 44x44px
6. 无横向滚动
7. 小屏幕上表单可用
```

### 可访问性(a11y)测试

**WCAG 2.1 AA级检查清单:**
```
1. 可感知:
   - 图片的alt文本
   - 视频字幕
   - 颜色对比度 ≥ 4.5:1
   - 文本可缩放至200%

2. 可操作:
   - 键盘导航(Tab、Enter、Esc)
   - 无键盘陷阱
   - 跳转到主内容链接
   - 焦点指示器可见

3. 可理解:
   - HTML中声明语言
   - 一致的导航
   - 错误识别和建议
   - 表单输入的标签

4. 健壮:
   - 有效的HTML标记
   - 需要时使用ARIA标签
   - 屏幕阅读器兼容性
```

## 移动App测试模式

### 平台特定考虑

**iOS测试:**
```
1. 操作系统版本:最新3个主要版本
2. 设备:iPhone SE、iPhone 14、iPhone 14 Pro Max、iPad
3. 刘海/灵动岛处理
4. 深色模式支持
5. 触觉反馈
6. App Store指南合规性
7. 隐私权限(相机、位置、照片)
8. 应用生命周期(后台/前台)
9. 推送通知
10. Face ID/Touch ID集成
```

**Android测试:**
```
1. 操作系统版本:Android 10、11、12、13、14
2. 设备:各种屏幕尺寸和分辨率
3. 制造商皮肤(三星OneUI、小米MIUI)
4. 返回按钮行为
5. 硬件返回手势
6. 分屏多任务
7. 应用权限(运行时权限)
8. 后台限制
9. 电池优化
10. 通知渠道
```

### 网络条件测试

**场景:**
```
1. 无连接:
   - 离线模式功能
   - 缓存数据显示
   - 队列操作以便稍后同步
   - 清晰的错误消息

2. 慢速连接(2G、3G):
   - 超时处理
   - 加载指示器
   - 渐进式内容加载
   - 降低质量选项(图片、视频)

3. 间歇性连接:
   - 重试逻辑
   - 数据同步冲突
   - 部分数据加载

4. 网络切换:
   - WiFi → 蜂窝网络转换
   - 切换期间保持会话
   - 带宽自适应
```

### 性能测试

**关键指标:**
```
1. 应用启动时间:
   - 冷启动:< 2秒
   - 温启动:< 1秒
   - 热启动:< 500毫秒

2. 内存使用:
   - 无内存泄漏
   - 保持在操作系统限制内
   - 处理低内存警告

3. 电池消耗:
   - 后台电池消耗
   - 位置服务影响
   - 网络请求优化

4. 渲染:
   - 动画60 FPS
   - 滚动无卡顿
   - 平滑过渡
```

## 性能测试模式

### 负载测试场景

**渐进式增压测试:**
```
开始:10个用户
增量:每30秒+10个用户
持续时间:10分钟
监控:响应时间、错误率、资源使用

成功标准:
- 95百分位响应时间< 2秒
- 错误率< 0.1%
- CPU使用率< 80%
- 内存稳定(无泄漏)
```

**压力测试:**
```
逐渐增加负载超出预期容量
识别临界点
监控优雅降级

示例:
预期容量:1000个用户
测试:增加到2000个用户
观察:系统在什么点失败?
恢复:负载减少时系统是否恢复?
```

**尖峰测试:**
```
突然负载增加模拟

场景:
正常负载:100个用户
尖峰:瞬间跳到1000个用户
持续时间:5分钟
返回:回到100个用户

监控:
- 系统是否处理尖峰?
- 尖峰后恢复时间
- 数据完整性保持
```

### 数据库性能测试

**查询优化:**
```
1. 使用实际数据量测试
2. 识别慢查询(> 1秒)
3. 验证索引使用(EXPLAIN计划)
4. 测试并发连接
5. 监控死锁和锁争用
6. 验证连接池大小
```

## 安全测试模式

### OWASP Top 10测试用例

**注入:**
```
SQL注入:' OR '1'='1' --
NoSQL注入:{"$ne": null}
命令注入:; ls -la
LDAP注入:*)(uid=*))(|(uid=*
XPath注入:' or '1'='1
```

**身份验证失效:**
```
- 暴力破解密码猜测
- 会话固定攻击
- 会话劫持(XSS cookie窃取)
- 绕过弱密码策略
- 使用泄露密码的凭证填充
```

**XSS(跨站脚本):**
```
存储型XSS:<script>alert(document.cookie)</script>
反射型XSS:?search=<script>alert(1)</script>
基于DOM的XSS:#<img src=x onerror=alert(1)>
```

**CSRF(跨站请求伪造):**
```
测试:在没有CSRF token的情况下提交状态改变请求
预期:请求应被拒绝
验证:存在并验证反CSRF token
```